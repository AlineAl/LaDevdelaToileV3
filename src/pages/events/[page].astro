---
import Layout from "../../layouts/Layout.astro";
import Footer from "../../components/Footer.astro";
import InputAndFilter from "../../components/InputAndFilter.astro";
import GetOrHideMapButton from "../../components/GetOrHideMapButton.astro";
import { getCollection } from "astro:content";
import Pagination from "../../components/Pagination.astro";

export const prerender = true;

export async function getStaticPaths({ paginate }) {
    const eventsData = await getCollection("events");
    return paginate(eventsData, { pageSize: 3 });
}

const { page } = Astro.props;
const currentPage = page.currentPage;
const totalPages = page.lastPage;
---

<Layout title="Événements">
    <h1 class="text-4xl text-center font-bold mt-8">Événements</h1>
    <p class="text-center text-lg mt-4 mx-4">
        Retrouvez ici une liste non-exhaustive de nombreux événements et communautés dev.
    </p>

    <GetOrHideMapButton />
    <InputAndFilter />

    <ul>
        {page.data.map((event, eventIndex) => (
            <li key={eventIndex}>
                {event.data.communities.map((community, communityIndex) => (
                    <ul key={communityIndex}>
                        {community.events.map((d, i) => (
                            <li key={i}>
                                <a
                                    href={d.link}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    <div class="min-h-full flex flex-col items-center gap-4 border border-default bg-offset p-6 transition duration-300 ease-in-out hover:cursor-pointer hover:text-white hover:bg-sky-700">
                                        <p class="text-center font-extrabold text-xl">{d.title}</p>
                                        <p class="text-center text-offset text-sm">{d.organizationName}</p>
                                    </div>
                                </a>
                            </li>
                        ))}
                    </ul>
                ))}
            </li>
        ))}
    </ul>

    <Pagination page={page} currentPage={currentPage} totalPages={totalPages} />

    <Footer />
</Layout>
